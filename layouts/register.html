{% extends 'site.html' %}

{% block id -%}
	register
{%- endblock %}

{% block headline -%}
	Register
{%- endblock %}

{% block main %}

	<p>We provide a discount for students of Wycliffe and Tyndale Seminary.</p>

	<form action="http://159.203.6.69:14984/stripe" method="POST">
	  <span class="payment-errors"></span>
		<div class="form-field">
			<div class="form-field-label">
				<label for="full_name">Full Name</label>
			</div>
			<div class="form-field-input">
				<input type="text" name="full_name" id="full_name" />
			</div>
		</div>
		<div class="form-field">
			<div class="form-field-label">
				<label for="email">Email Address</label>
			</div>
			<div class="form-field-input">
				<input type="email" name="email" />
			</div>
		</div>
		<div class="form-field">
			<div class="form-field-label">
				<label for="ticket_type">Ticket Type</label>
			</div>
			<div class="form-field-input">
				<label class="inline-label"><input type="radio" name="ticket_type" id="ticket_type_REGULAR" value="regular" checked /> Regular ($40)</label>
				<label class="inline-label"><input type="radio" name="ticket_type" id="ticket_type_STUDENT" value="student" /> Student ($20)</label>
			</div>
		</div>
		<h3>Payment Details</h3>
	  <div class="form-field">
			<div class="form-field-label">
				<label for="cc_number">Card Number</label>
			</div>
			<div class="form-field-input">
				<input type="text" name="cc_number" id="cc_number" size="20" data-stripe="number"/>
			</div>
	  </div>
	  <div class="form-field">
			<div class="form-field-label">
				<label for="cvc_number">CVC</label>
			</div>
			<div class="form-field-input">
				<input type="text" name="cvc_number" id="cvc_number" size="4" data-stripe="cvc"/>
			</div>
	  </div>
	  <div class="form-field">
			<div class="form-field-label">
				<span>Expiry Date</span>
			</div>
			<div class="form-field-input">
				<input type="text" size="2" data-stripe="exp-month"/>
				<span> / </span>
				<input type="text" size="4" data-stripe="exp-year"/>
				<span>MM / YYYY</span>
			</div>
	  </div>
	  <button type="submit">Make Payment</button>
	</form>
	<script src="https://js.stripe.com/v2/"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<script>
	  Stripe.setPublishableKey('pk_test_VZPVSdywILB4qPH8LYdsw5il');
		$(function () {
			$('#payment-form').on('submit', function (e) {
				e.preventDefault()
				var $form = $(this)
				$form.find('button').prop('disabled', true)
		    Stripe.card.createToken($form, stripeResponseHandler)
			})
			function stripeResponseHandler(status, response) {
				var $form = $('#payment-form')

				if (response.error) {
					// Show the errors on the form
					$form.find('.payment-errors').text(response.error.message)
					$form.find('button').prop('disabled', false)
				} else {
					// response contains id and card, which contains additional card details
					var token = response.id
					// Insert the token into the form so it gets submitted to the server
					$form.append($('<input type="hidden" name="stripe_token" />').val(token))
					// and submit
					$form.get(0).submit()
				}
			}
		})
	</script>

{% endblock %}
